<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
 
    <title>Taboleiro de noticias</title>
 
    <style type="text/css">
        .scrollWrapper   {
            width:32%;height:400px;
			margin-bottom:1vw;
			margin-left:0.5%;
			margin-right:0.5%;
            font-family:Arial;
			font-size:0.8em;
			float:left;
			z-index: -2;
			background-image: url('/img/papel.jpg');
			background-size: contain;
			border-radius: 4%;
			transform: rotate(3deg);
        }
        .scrollTitle {
			height:8%;
			position:relative;
            padding:5px;
            font-weight:bold;
			z-index: 1;
			display: flex;
			justify-content: center;
			align-items: center
			
        }
        .scroll    {
            position:relative;
            width:auto;
            margin:1px;
            z-index: 0;
            padding:5px;
        }
		.container{overflow: hidden; width:100%;height:88%;}
        .scroll .title  {font-weight:bold;margin-top:20px;}
		.chincheta{
			position:absolute;
			left: -5%;
			top: -8%;
			width:5vw;height:auto;
		}
		.celo{
			position:absolute;
			left: -15%;
			top: -20%;
			width:30%;height:100%;
		}
		a{
			z-index: 20;
		}
		video{
			z-index: 20;
		}
		body{
			background-image: url('/img/corcho.jpg')
		}
		h1{
			position:relative;
			background-image: url('/img/papel.jpg');
			background-size: contain;
			width:25%;
			font-family:Garamond;
			border-radius: 4%;
		}
		.parpadea {
	  
			animation-name: parpadeo;
			animation-duration: 1s;
			animation-timing-function: linear;
			animation-iteration-count: infinite;

			-webkit-animation-name:parpadeo;
			-webkit-animation-duration: 1s;
			-webkit-animation-timing-function: linear;
			-webkit-animation-iteration-count: infinite;
		}

		@-moz-keyframes parpadeo{  
			0% { opacity: 1.0; }
			50% { opacity: 0.0; }
			100% { opacity: 1.0; }
		}

		@-webkit-keyframes parpadeo {  
			0% { opacity: 1.0; }
			50% { opacity: 0.0; }
			100% { opacity: 1.0; }
		}

		@keyframes parpadeo {  
			0% { opacity: 1.0; }
			50% { opacity: 0.0; }
			100% { opacity: 1.0; }
		}
		
    </style>
	
	
	
   
</head>
 
<body>
 <center id="Body">
 
<h1><img src="img/celo.png" class="celo">Taboleiro de noticias</H1>
</center>
</body>

 <script type="text/javascript" src="Concurrent.Thread.js"></script>
 
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 
 <script type="text/javascript">
		var basescrollspeed=1;
		var mouseOn = "";
        var speedjump=30;
        var startdelay= 1;
        var topspace=-10;

 
        /**
         * Inicio del scroll
         * Esta funci√≥n es llamada en el body de la pagina.
         * Tiene que recibir el id del scroll
         */
		 
		 function sleep(milliseconds) {
		  const date = Date.now();
		  let currentDate = null;
		  do {
			currentDate = Date.now();
		  } while (currentDate - date < milliseconds);
		}
		 
        function scrollStart(IdName)
        {
            dataobj = document.getElementById(IdName);
            // cogemos la altura maxima de la capa de las noticias
            alturaNoticias = dataobj.offsetHeight;
            // posicionamos la capa del scroll en su posicion inicial
            var frameheight = document.getElementById("container"+IdName).clientHeight;
			dataobj.style.top = frameheight + 'px';
            while(true){
				dataobj = document.getElementById(IdName);
				// Restamos a la propiedad top de la capa el valor en pixeles
				// establecido en la variable "scrollspeed", para hacer el
				// movimiento hacia arriba.
				if(IdName==mouseOn)scrollspeed = 0;
				else scrollspeed = basescrollspeed;
				dataobj.style.top = parseInt(dataobj.style.top) - scrollspeed + 'px';
				// Si la capa ha sobrepasado la altura del area por donde se muestran
				// las noticias ("alturaNoticias")
				if (parseInt(dataobj.style.top) < dataobj.offsetHeight * (-1))
				{
					// Posicionamos la capa en la parte inferior del recuadro, para
					// que simule que vienen las noticias de la parte inferior
					var frameheight = document.getElementById("container"+IdName).clientHeight;
					dataobj.style.top = frameheight + 'px';
					fillTable(IdName);
				}else{
					sleep(speedjump);
				}
			}
        }
		
		function add(json,categoria){
			var scroll = document.getElementById(categoria);
			var container = document.createElement("div");
			var color=null;
			var letra=null;
			var colorLetra=null;
			
			if(json.Color!="null" && json.Color!="")color=json.Color;
			else color="white";
			if(json.Letra!="null" && json.Letra!="")letra=json.Letra;
			if(json.ColorLetra!="null" && json.ColorLetra!="")colorLetra=json.ColorLetra;

			
			if(json.Tipo=="Importante"){
				var e = document.createElement("div");
				e.innerHTML="Importante!!!!";
				e.setAttribute("class","parpadea");
				if(color!="red") e.setAttribute("style","color:red;font-family:"+letra+";font-size:145%;font-family:helvetica;font-weight:bold;");
				else e.setAttribute("style","color:yellow;font-family:"+letra+";");
				container.appendChild(e);
			}
			
			if(categoria=="OUTRAS" && json.Categoria!="OUTRAS" && json.Categoria!="null" && json.Categoria!=""){
				var e = document.createElement("I");
				e.innerHTML=json.Categoria;
				e.setAttribute("style","font-family:"+letra+";font-size:125%;color:Gray");
				container.appendChild(e);
			}
			
			if(json.Titulo!="null"){
				var e = document.createElement("div");
				e.innerHTML=json.Titulo;
				e.setAttribute("style","font-family:"+letra+";font-size:200%;color:"+colorLetra);
				container.appendChild(e);
			}
			
			if(json.Texto!="null"){
				var e = document.createElement("div");
				e.innerHTML=json.Texto;
				e.setAttribute("style","font-family:"+letra+";padding-left:2%;padding-right:2%;color:"+colorLetra);
				container.appendChild(e);
			}
			
			var e = document.createElement("br");
			container.appendChild(e);
			
			if(json.Video!="null" && json.Video!=""){
				var e = document.createElement("video");
				e.setAttribute("controls","true");
				e.setAttribute("width","75%;");
				var source = document.createElement("source");
				source.setAttribute("src",json.Video);
				e.appendChild(source);
				container.appendChild(e);
			}
			
			if(json.Imagen!="null" && (json.Video=="null" || json.Video=="")){
				var e = document.createElement("img");
				e.setAttribute("src",json.Imagen);
				e.setAttribute("width","75%");
				e.setAttribute("height","auto");
				container.appendChild(e);
				
			}
			
			if(json.Autor!="null"){
				var e = document.createElement("div");
				e.innerHTML=json.Autor;
				e.setAttribute("style","font-family:"+letra+";text-align:right;font-size:75%;");
				container.appendChild(e);
			}
			if(json.Fecha!="null"){
				var e = document.createElement("div");
				e.innerHTML="("+json.Fecha+")";
				e.setAttribute("style","font-family:"+letra+";text-align:right;font-size:65%;");
				container.appendChild(e);
			}
				
				if(color)container.setAttribute("style","background-color:"+color+";");
				scroll.appendChild(container);
				
				var e = document.createElement("hr");
				container.appendChild(e);
		}
		
		function fillTable(categoria){
			var scroll = document.getElementById(categoria);
			var child = scroll.lastElementChild; 
			while (child) {
				scroll.removeChild(child);
				child = scroll.lastElementChild;
			}
			
			fetch("/Categoria/"+categoria)
				.then(function (response) {
					if (response.status != 200) {
						if (response.status == 404) {
							alert("Categorias list not found");
						}
						else if (response.status == 400) {
							alert("Bad request : Please, back to HOME page and insert valid data");
						}
						else {
							throw new Error(response.status);
						}
					}

					return response.json();
				})
				.then(function (myJson) {
					myJson.forEach(obj => {add(obj,categoria);});
				})
				.catch(function (error) {
					console.log("Error: " + error);
				});
			
		}
		

		function createTable(categoria){

			var wrap = document.createElement("div");
			wrap.setAttribute("class","scrollWrapper");
			wrap.setAttribute("onMouseover","mouseOn=\""+categoria+"\"");
			wrap.setAttribute("onMouseout","mouseOn=\"\"")
			
			var title = document.createElement("div");
			title.setAttribute("class","scrollTitle");
			title.innerHTML=categoria;
			
			var chincheta = document.createElement("img");
			chincheta.setAttribute("src","img/chincheta.png");
			chincheta.setAttribute("class","chincheta");
			chincheta.innerHTML=categoria;
			
			var container = document.createElement("div");
			container.setAttribute("id","container"+categoria);
			container.setAttribute("class","container");
			
			var scroll = document.createElement("div");
			scroll.setAttribute("id",categoria);
			scroll.setAttribute("class","scroll");
			
			container.appendChild(scroll);
			title.appendChild(chincheta);
			wrap.appendChild(title);
			wrap.appendChild(container);
			document.getElementById("Body").appendChild(wrap);
			
			
			Concurrent.Thread.create(scrollStart,categoria);
		}
		
		function main(){
			fetch("/Categoria")
				.then(function (response) {
					if (response.status != 200) {
						if (response.status == 404) {
							alert("Categorias list not found");
						}
						else if (response.status == 400) {
							alert("Bad request : Please, back to HOME page and insert valid data");
						}
						else {
							throw new Error(response.status);
						}
					}

					return response.json();
				})
				.then(function (myJson) {
					myJson.forEach(obj => {createTable(obj);});
				})
				.catch(function (error) {
					console.log("Error: " + error);
				});
		}
		
		
		
		main();

    </script>
</html>